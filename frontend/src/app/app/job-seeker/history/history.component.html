<app-jobseeker-sidebar></app-jobseeker-sidebar>
<br><br><br><br><br>
<div class="w-full bg-blue-50 p-4" [ngClass]="{'dark-mode': isDarkMode}">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-600"></div>
  </div>

  <!-- Header -->
  <div class="bg-white rounded-lg shadow-lg p-6 mb-6 sticky top-0 z-10">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <button [routerLink]="['/jobseeker-dashboard']" class="text-blue-600 hover:text-blue-800 mr-4" aria-label="Back to dashboard">
          <i class="fas fa-arrow-left text-lg">Back</i>
        </button>
        <div>
          <h1 class="text-2xl font-bold text-blue-800">Application History</h1>
          <p class="text-sm text-blue-600">View your past job applications (Total: {{ getApplicationCount() }})</p>
        </div>
      </div>
      <div class="flex gap-2">
        <button (click)="toggleDarkMode()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 flex items-center">
          <i class="fas" [ngClass]="isDarkMode ? 'fa-sun' : 'fa-moon'" class="mr-2"></i> {{ isDarkMode ? 'Light Mode' : 'Dark Mode' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Application History Content -->
  <div class="bg-white rounded-lg shadow-lg p-6">
    <div *ngIf="!isLoading" class="space-y-4">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-blue-800">Your Applications</h2>
        <select [(ngModel)]="filterStatus" (ngModelChange)="applyFilters()" class="p-2 border border-blue-200 rounded-md text-sm text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">All Statuses</option>
          <option value="Under Review">Under Review</option>
          <option value="Interview">Interview</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-blue-200">
          <thead class="bg-blue-50">
            <tr>
              <th (click)="sortApplications('jobTitle')" class="px-4 py-2 text-left text-xs font-medium text-blue-800 uppercase cursor-pointer">
                Job Title
                <i class="fas" [ngClass]="sortColumn === 'jobTitle' && sortDirection === 'asc' ? 'fa-sort-up' : sortColumn === 'jobTitle' && sortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort'"></i>
              </th>
              <th (click)="sortApplications('company')" class="px-4 py-2 text-left text-xs font-medium text-blue-800 uppercase cursor-pointer">
                Company
                <i class="fas" [ngClass]="sortColumn === 'company' && sortDirection === 'asc' ? 'fa-sort-up' : sortColumn === 'company' && sortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort'"></i>
              </th>
              <th (click)="sortApplications('date')" class="px-4 py-2 text-left text-xs font-medium text-blue-800 uppercase cursor-pointer">
                Date
                <i class="fas" [ngClass]="sortColumn === 'date' && sortDirection === 'asc' ? 'fa-sort-up' : sortColumn === 'date' && sortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort'"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-blue-800 uppercase">Status</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-blue-800 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-blue-200">
            <tr *ngFor="let app of getFilteredApplications() | paginate: { itemsPerPage: pageSize, currentPage: currentPage }" class="hover:bg-blue-50 transition-colors duration-200">
              <td class="px-4 py-2 text-sm text-blue-600">{{ app.jobTitle }}</td>
              <td class="px-4 py-2 text-sm text-blue-600">{{ app.company }}</td>
              <td class="px-4 py-2 text-sm text-blue-600">{{ app.date | date:'mediumDate' }}</td>
              <td class="px sportsbook4 py-2 text-sm">
                <span class="px-2 py-1 rounded-full text-xs" [ngClass]="{
                  'bg-blue-100 text-blue-800': app.status === 'Under Review',
                  'bg-green-100 text-green-800': app.status === 'Interview',
                  'bg-red-100 text-red-800': app.status === 'Rejected'
                }">{{ app.status }}</span>
              </td>
              <td class="px-4 py-2 text-sm">
                <button (click)="viewApplicationDetails(app.id)" class="text-blue-600 hover:text-blue-800 flex items-center">
                  <i class="fas fa-eye mr-1"></i> View
                </button>
              </td>
            </tr>
            <tr *ngIf="getFilteredApplications().length === 0">
              <td colspan="5" class="px-4 py-2 text-center text-sm text-blue-600">No applications found</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <div class="flex justify-center mt-6">
        <div class="flex items-center gap-2">
          <button (click)="handlePageEvent(currentPage - 1)" [disabled]="currentPage === 1" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="text-sm text-gray-700">Page {{ currentPage }} of {{ totalPages }}</span>
          <button (click)="handlePageEvent(currentPage + 1)" [disabled]="currentPage === totalPages" class="px-3 py-1 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 disabled:bg-gray-100 disabled:cursor-not-allowed">
            <i class="fas fa-chevron-right"></i>
          </button>
          <select [(ngModel)]="pageSize" (ngModelChange)="applyFilters()" class="p-2 border border-blue-200 rounded-md text-sm text-blue-600">
            <option value="5">5 per page</option>
            <option value="10">10 per page</option>
            <option value="20">20 per page</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>