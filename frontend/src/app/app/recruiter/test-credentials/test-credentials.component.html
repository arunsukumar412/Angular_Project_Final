<div class="w-full bg-white">
      <app-recruiter-sidebar></app-recruiter-sidebar>
  <div class="flex ml-64 overflow-hidden">
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Header -->
      <app-hr-header></app-hr-header>
      <br><br>

      <!-- Main Content -->
      <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">
        <div class="container mx-auto px-4 py-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-gray-900">Test Credentials & Monitoring</h1>
              <p class="text-gray-600 text-sm">Manage test credentials and monitor candidate test progress.</p>
            </div>
            <div class="mt-4 md:mt-0 flex items-center space-x-2">
              <button class="bg-indigo-500 hover:bg-indigo-600 text-white py-1.5 px-3 rounded-md flex items-center transition-colors duration-200" (click)="openAddCandidateModal()" aria-label="Add new candidate">
                <i class="fas fa-plus mr-1.5 text-xs"></i>
                <span>Add Candidate</span>
              </button>
              <button class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-1.5 px-3 rounded-md flex items-center transition-colors duration-200" (click)="exportCandidates()" aria-label="Export candidates">
                <i class="fas fa-download mr-1.5 text-xs"></i>
                <span>Export</span>
              </button>
              <button class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-1.5 px-3 rounded-md flex items-center transition-colors duration-200" (click)="openEmailTemplateModal()" aria-label="Edit email template">
                <i class="fas fa-envelope mr-1.5 text-xs"></i>
                <span>Email Template</span>
              </button>
            </div>
          </div>

          <!-- Filters and Bulk Actions -->
          <div class="bg-white rounded-md shadow border border-gray-200 mb-6 p-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
              <div class="flex flex-wrap items-center gap-2">
                <select class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" [(ngModel)]="filters.position" (change)="filterCandidates()" aria-label="Filter by position">
                  <option value="">All Positions</option>
                  <option *ngFor="let position of positions" [value]="position">{{ position }}</option>
                </select>
                <select class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" [(ngModel)]="filters.status" (change)="filterCandidates()" aria-label="Filter by status">
                  <option value="">All Statuses</option>
                  <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
                </select>
                <select class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" [(ngModel)]="filters.rating" (change)="filterCandidates()" aria-label="Filter by rating">
                  <option value="">All Ratings</option>
                  <option value="1">1 Star</option>
                  <option value="2">2 Stars</option>
                  <option value="3">3 Stars</option>
                  <option value="4">4 Stars</option>
                  <option value="5">5 Stars</option>
                </select>
                <select class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" [(ngModel)]="filters.testStatus" (change)="filterCandidates()" aria-label="Filter by test status">
                  <option value="">All Test Statuses</option>
                  <option value="Not Started">Not Started</option>
                  <option value="In Progress">In Progress</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>
              <div class="mt-2 md:mt-0 flex items-center space-x-2">
                <button class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" [disabled]="!selectedCandidates.length" (click)="bulkResendCredentials()" aria-label="Resend credentials to selected candidates">Resend Credentials</button>
                <button class="border border-gray-300 rounded-md py-1.5 px-3 text-sm" (click)="clearFilters()" aria-label="Clear filters">Clear Filters</button>
              </div>
            </div>
          </div>

          <!-- Shortlisted Candidates Table -->
          <div class="bg-white rounded-md shadow overflow-hidden border border-gray-200 mb-6">
            <div class="p-4 border-b border-gray-200">
              <h2 class="text-base font-medium text-gray-900">Shortlisted Candidates</h2>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-100">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                      <input type="checkbox" (change)="toggleSelectAll($event)" aria-label="Select all candidates" />
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider cursor-pointer" (click)="sortBy('name')" aria-label="Sort by name">Name <i class="fas" [ngClass]="sortIcon('name')"></i></th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Position</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Skills</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Rating</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Credentials</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Test Status</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-100">
                  <tr *ngFor="let candidate of paginatedCandidates" class="hover:bg-gray-50">
                    <td class="px-4 py-3 whitespace-nowrap">
                      <input type="checkbox" [(ngModel)]="candidate.selected" (change)="updateSelectedCandidates()" aria-label="Select candidate" />
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <div class="flex items-center">
                        <img class="h-8 w-8 rounded-full" [src]="candidate.image" alt="Candidate profile" />
                        <div class="ml-3">
                          <div class="text-sm font-medium text-gray-900">{{ candidate.name }}</div>
                          <div class="text-xs text-gray-600">{{ candidate.email }}</div>
                        </div>
                      </div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ candidate.position }}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <span *ngFor="let skill of candidate.skills; let last = last" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 mr-1">{{ skill }}{{ !last ? ',' : '' }}</span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <div class="flex items-center">
                        <i *ngFor="let i of [1,2,3,4,5]" class="fas fa-star cursor-pointer" [ngClass]="i <= candidate.rating ? 'text-yellow-400' : 'text-gray-300'" (click)="rateCandidate(candidate, i)" aria-label="Rate candidate"></i>
                      </div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                      <button class="text-indigo-500 hover:text-indigo-700" (click)="viewCredentials(candidate)" aria-label="View test credentials">View</button>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-medium rounded-full" [ngClass]="candidate.testStatusColor">{{ candidate.testStatus }}</span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium">
                      <button class="text-indigo-500 hover:text-indigo-700 mr-3" (click)="viewResume(candidate)" aria-label="View resume">View Resume</button>
                      <button class="text-indigo-500 hover:text-indigo-700 mr-3" (click)="viewNotes(candidate)" aria-label="View notes">Notes</button>
                      <button class="text-indigo-500 hover:text-indigo-700 mr-3" (click)="openScheduleInterviewModal(candidate)" aria-label="Schedule interview">Schedule</button>
                      <button class="text-red-500 hover:text-red-700" (click)="removeCandidate(candidate.id)" aria-label="Remove candidate">Remove</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="px-4 py-3 border-t border-gray-200 flex items-center justify-between">
              <div class="text-xs text-gray-600">Showing <span class="font-medium">{{ paginatedCandidates.length }}</span> of <span class="font-medium">{{ filteredCandidates.length }}</span> candidates</div>
              <div class="flex space-x-2">
                <button class="px-3 py-1 border border-gray-300 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50" (click)="previousPage()" [disabled]="currentPage === 1" aria-label="Previous page">Previous</button>
                <button class="px-3 py-1 border border-gray-300 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="nextPage()" [disabled]="currentPage * itemsPerPage >= filteredCandidates.length" aria-label="Next page">Next</button>
              </div>
            </div>
          </div>

          <!-- Test Platform Monitoring -->
          <div class="bg-white rounded-md shadow overflow-hidden border border-gray-200">
            <div class="p-4 border-b border-gray-200">
              <h2 class="text-base font-medium text-gray-900">Test Platform Monitoring</h2>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-100">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Position</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Test Status</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Progress</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Last Updated</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-100">
                  <tr *ngFor="let candidate of filteredCandidates" class="hover:bg-gray-50">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ candidate.name }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ candidate.position }}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-medium rounded-full" [ngClass]="candidate.testStatusColor">{{ candidate.testStatus }}</span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ candidate.testProgress }}%</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ candidate.testLastUpdated | date:'short' }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium">
                      <button class="text-indigo-500 hover:text-indigo-700" (click)="updateTestStatus(candidate)" aria-label="Update test status">Update Status</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Add Candidate Modal -->
          <div *ngIf="showAddCandidateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-md">
              <h2 class="text-base font-medium text-gray-900 mb-4">Add New Candidate</h2>
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-medium text-gray-700">Name</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newCandidate.name" aria-label="Candidate name" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Email</label>
                  <input type="email" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newCandidate.email" aria-label="Candidate email" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Position</label>
                  <select class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newCandidate.position" aria-label="Position">
                    <option *ngFor="let position of positions" [value]="position">{{ position }}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Skills</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter skills (comma-separated)" [(ngModel)]="newCandidate.skillsInput" (input)="parseSkills()" aria-label="Skills" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Source</label>
                  <select class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newCandidate.source" aria-label="Source">
                    <option *ngFor="let source of sources" [value]="source">{{ source }}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Resume</label>
                  <input type="file" accept=".pdf" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm" (change)="handleResumeUpload($event)" aria-label="Upload resume" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Notes</label>
                  <textarea class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newCandidate.notes" aria-label="Notes"></textarea>
                </div>
              </div>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeAddCandidateModal()" aria-label="Cancel">Cancel</button>
                <button class="px-3 py-1.5 border border-indigo-500 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="addCandidate()" [disabled]="!isAddCandidateFormValid()" aria-label="Add candidate">Add</button>
              </div>
            </div>
          </div>

          <!-- Credentials Viewer Modal -->
          <div *ngIf="showCredentialsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-md">
              <h2 class="text-base font-medium text-gray-900 mb-4">Test Credentials: {{ selectedCandidate?.name }}</h2>
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-medium text-gray-700">Username</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm bg-gray-100" [value]="selectedCandidate?.credentials?.username" disabled aria-label="Username" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Password</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm bg-gray-100" [value]="selectedCandidate?.credentials?.password" disabled aria-label="Password" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Test Link</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm bg-gray-100" [value]="selectedCandidate?.credentials?.testLink" disabled aria-label="Test link" />
                </div>
              </div>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeCredentialsModal()" aria-label="Close">Close</button>
                <button class="px-3 py-1.5 border border-indigo-500 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="resendCredentials(selectedCandidate)" aria-label="Resend credentials">Resend</button>
              </div>
            </div>
          </div>

          <!-- Resume Viewer Modal -->
          <div *ngIf="showResumeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-4xl">
              <h2 class="text-base font-medium text-gray-900 mb-4">Resume: {{ selectedCandidate?.name }}</h2>
              <div class="relative">
                <iframe [src]="selectedCandidate?.resumeUrl" class="w-full h-[600px] border border-gray-300" title="Candidate resume"></iframe>
                <div *ngIf="searchQuery" class="absolute top-0 left-0 p-2 bg-white bg-opacity-75">
                  <p class="text-xs text-gray-600">Keywords: <span class="font-medium">{{ searchQuery }}</span></p>
                </div>
              </div>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeResumeModal()" aria-label="Close resume viewer">Close</button>
              </div>
            </div>
          </div>

          <!-- Notes Modal -->
          <div *ngIf="showNotesModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-md">
              <h2 class="text-base font-medium text-gray-900 mb-4">Notes for {{ selectedCandidate?.name }}</h2>
              <textarea class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="selectedCandidate" aria-label="Candidate notes"></textarea>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeNotesModal()" aria-label="Cancel">Cancel</button>
                <button class="px-3 py-1.5 border border-indigo-500 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="saveNotes()" aria-label="Save notes">Save</button>
              </div>
            </div>
          </div>

          <!-- Schedule Interview Modal -->
          <div *ngIf="showScheduleInterviewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-md">
              <h2 class="text-base font-medium text-gray-900 mb-4">Schedule Interview</h2>
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-medium text-gray-700">Candidate</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm bg-gray-100" [value]="selectedCandidate?.name" disabled aria-label="Candidate name" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Position</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm bg-gray-100" [value]="selectedCandidate?.position" disabled aria-label="Position" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Interviewer</label>
                  <select class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newInterview.interviewerId" aria-label="Interviewer">
                    <option *ngFor="let interviewer of interviewers" [value]="interviewer.id">{{ interviewer.name }}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Date</label>
                  <input type="date" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newInterview.date" [min]="todayDate" aria-label="Interview date" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Time</label>
                  <input type="time" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newInterview.time" aria-label="Interview time" />
                </div>
              </div>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeScheduleInterviewModal()" aria-label="Cancel">Cancel</button>
                <button class="px-3 py-1.5 border border-indigo-500 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="scheduleInterview()" [disabled]="!isScheduleInterviewFormValid()" aria-label="Schedule interview">Schedule</button>
              </div>
            </div>
          </div>

          <!-- Email Template Modal -->
          <div *ngIf="showEmailTemplateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-md">
              <h2 class="text-base font-medium text-gray-900 mb-4">Edit Email Template</h2>
              <div class="space-y-4">
                <div>
                  <label class="block text-xs font-medium text-gray-700">Subject</label>
                  <input type="text" class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="emailTemplate.subject" aria-label="Email subject" />
                </div>
                <div>
                  <label class="block text-xs font-medium text-gray-700">Body</label>
                  <textarea class="block w-full border border-gray-300 rounded-md py-1.5 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="emailTemplate.body" rows="6" aria-label="Email body"></textarea>
                </div>
              </div>
              <div class="mt-4 flex justify-end space-x-2">
                <button class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-600 hover:bg-gray-50" (click)="closeEmailTemplateModal()" aria-label="Cancel">Cancel</button>
                <button class="px-3 py-1.5 border border-indigo-500 rounded-md text-xs font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="saveEmailTemplate()" aria-label="Save template">Save</button>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <app-hr-footer></app-hr-footer>
    </div>
  </div>
</div>

<style>
  .custom-scroll::-webkit-scrollbar {
    width: 5px;
  }
  .custom-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 8px;
  }
  .custom-scroll::-webkit-scrollbar-thumb {
    background: #a0aec0;
    border-radius: 8px;
  }
  .custom-scroll::-webkit-scrollbar-thumb:hover {
    background: #718096;
  }
</style>