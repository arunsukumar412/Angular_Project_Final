<app-recruiter-sidebar></app-recruiter-sidebar>
<div class="w-full bg-white">
  <div class="flex ml-64 overflow-hidden">
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Top Navigation -->
      <app-hr-header></app-hr-header>
      <br><br>

      <!-- Main Content Area -->
      <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">
        <div class="container mx-auto px-4 py-6">
          <!-- Dashboard Header -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <div>
              <h1 class="text-xl font-bold text-gray-900">Job Posting</h1>
              <p class="text-gray-600 text-sm">Create and manage job postings efficiently.</p>
            </div>
            <div class="mt-4 md:mt-0">
              <div class="flex items-center space-x-2">
                <button class="bg-indigo-500 hover:bg-indigo-600 text-white py-2 px-4 rounded-md flex items-center transition-colors duration-200" (click)="openPostJobModal()">
                  <i class="fas fa-plus mr-2 text-sm"></i>
                  <span>Post New Job</span>
                </button>
                <button class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-2 px-4 rounded-md flex items-center transition-colors duration-200" (click)="refreshData()">
                  <i class="fas fa-sync-alt mr-2 text-sm"></i>
                  <span>Refresh</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Job List -->
          <div class="bg-white rounded-md shadow overflow-hidden border border-gray-200 mb-6">
            <div class="px-4 py-4 border-b border-gray-200 flex items-center justify-between">
              <h2 class="text-base font-medium text-gray-900">Posted Jobs</h2>
              <div class="flex items-center space-x-2">
                <select class="block appearance-none bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:text-sm w-1/4" [(ngModel)]="statusFilter" (change)="filterJobs()">
                  <option value="all">All Statuses</option>
                  <option value="Open">Open</option>
                  <option value="Closed">Closed</option>
                  <option value="Draft">Draft</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                  <i class="fas fa-chevron-down text-sm"></i>
                </div>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-100">
                <thead class="bg-gray-50">
                  <tr>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Job Title</th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Department</th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Location</th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Posted Date</th>
                    <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                    <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-100">
                  <tr *ngFor="let job of paginatedJobs" class="hover:bg-gray-50">
                    <td class="px-4 py-3 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ job.title }}</div>
                      <div class="text-xs text-gray-600">{{ job.description | slice:0:50 }}...</div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ getDepartmentName(job.department) }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ job.location }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ job.postedDate }}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-medium rounded-full" [ngClass]="job.statusColor">
                        {{ job.status }}
                      </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium">
                      <button class="text-indigo-500 hover:text-indigo-700 mr-3" (click)="openEditJobModal(job)">Edit</button>
                      <button class="text-red-500 hover:text-red-700" (click)="deleteJob(job.id)">Delete</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="px-4 py-3 border-t border-gray-200 flex items-center justify-between">
              <div class="text-xs text-gray-600">Showing <span class="font-medium">{{ paginatedJobs.length }}</span> of <span class="font-medium">{{ filteredJobs.length }}</span> jobs</div>
              <div class="flex space-x-2">
                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-600 bg-white hover:bg-gray-50" (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
                <button class="px-3 py-1 border border-indigo-500 rounded-md text-sm font-medium text-white bg-indigo-500 hover:bg-indigo-600" (click)="nextPage()" [disabled]="currentPage * itemsPerPage >= filteredJobs.length">Next</button>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <app-hr-footer></app-hr-footer>
    </div>
  </div>

  <!-- Post New Job Modal -->
  <div *ngIf="showPostJobModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-2xl">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Post New Job</h2>
      <div class="grid grid-cols-1 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700">Job Title</label>
          <input type="text" class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newJob.title" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Department</label>
          <select class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newJob.department" required>
            <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Location</label>
          <input type="text" class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newJob.location" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Description</label>
          <textarea class="block w-full border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" rows="4" [(ngModel)]="newJob.description" required></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Status</label>
          <select class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="newJob.status" required>
            <option value="Open">Open</option>
            <option value="Draft">Draft</option>
          </select>
        </div>
      </div>
      <div class="mt-8 flex justify-end space-x-4">
        <button class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-50" (click)="closePostJobModal()">Cancel</button>
        <button class="px-4 py-2 bg-indigo-500 text-white rounded-md text-sm font-medium hover:bg-indigo-600" (click)="postJob()" [disabled]="!isJobFormValid()">Post Job</button>
      </div>
    </div>
  </div>

  <!-- Edit Job Modal -->
  <div *ngIf="showEditJobModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-md shadow-lg p-6 w-full max-w-2xl">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Edit Job</h2>
      <div class="grid grid-cols-1 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700">Job Title</label>
          <input type="text" class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="editJob.title" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Department</label>
          <select class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="editJob.department" required>
            <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Location</label>
          <input type="text" class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="editJob.location" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Description</label>
          <textarea class="block w-full border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" rows="4" [(ngModel)]="editJob.description" required></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Status</label>
          <select class="block w-1/2 border border-gray-300 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" [(ngModel)]="editJob.status" required>
            <option value="Open">Open</option>
            <option value="Closed">Closed</option>
            <option value="Draft">Draft</option>
          </select>
        </div>
      </div>
      <div class="mt-8 flex justify-end space-x-4">
        <button class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-50" (click)="closeEditJobModal()">Cancel</button>
        <button class="px-4 py-2 bg-indigo-500 text-white rounded-md text-sm font-medium hover:bg-indigo-600" (click)="updateJob()" [disabled]="!isEditJobFormValid()">Update Job</button>
      </div>
    </div>
  </div>
</div>

<style>
  .custom-scroll::-webkit-scrollbar {
    width: 5px;
  }
  .custom-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 8px;
  }
  .custom-scroll::-webkit-scrollbar-thumb {
    background: #a0aec0;
    border-radius: 8px;
  }
  .custom-scroll::-webkit-scrollbar-thumb:hover {
    background: #718096;
  }
</style>
